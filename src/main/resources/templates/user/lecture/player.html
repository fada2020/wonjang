<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê°•ì˜</title>
    <link rel="stylesheet" th:href="@{/assets/css/style.css}">
    <style>
        .container {
            display: flex;
            justify-content: space-between;
        }

        .custom-video-player {
            width: 60%;
        }

        .lecture-feedback {
            width: 35%;
            padding-left: 20px;
            border-left: 2px solid #ddd;
        }

        .feedback-form {
            display: flex;
            flex-direction: column;
        }

        .feedback-form textarea {
            width: 100%;
            height: 150px;
            margin-bottom: 10px;
            padding: 10px;
        }

        .feedback-form button {
            padding: 10px;
            background-color: #4CAF50;
            color: white;
            border: none;
            cursor: pointer;
        }

        .feedback-form button:hover {
            background-color: #45a049;
        }

        .feedback-list {
            margin-bottom: 20px;
        }

        .feedback-item {
            border-bottom: 1px solid #ddd;
            padding: 10px 0;
        }

        .login-prompt {
            color: #ff0000;
            font-size: 16px;
        }
    </style>
</head>
<body>
<th:block th:replace="~{user/layout/header::header('ì›ì¥ì˜ ë˜¥ê¼¬ì‡¼')}" th:remove="tag"></th:block>

<div class="container">
    <div class="custom-video-player">
        <video id="videoPlayer">
            <source th:src="@{${lecture.videoUrl}}" type="video/mp4">
            <p>í˜„ì¬ ë¸Œë¼ìš°ì €ëŠ” ë¹„ë””ì˜¤ íƒœê·¸ë¥¼ ì§€ì›í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</p>
        </video>
        <div class="controls">
            <!-- 5ì´ˆ ë’¤ë¡œ -->
            <button class="play-btn" id="rewindBtn">âª</button>

            <!-- ì¬ìƒ/ì¼ì‹œì •ì§€ ë²„íŠ¼ -->
            <button class="play-btn" id="playPauseBtn">&#9654;</button>

            <!-- 5ì´ˆ ì•ìœ¼ë¡œ -->
            <button class="play-btn" id="forwardBtn"> â©</button>

            <!-- íƒ€ì„ë¼ì¸ -->
            <div class="timeline">
                <div class="progress">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
            </div>

            <!-- ë³¼ë¥¨ ì»¨íŠ¸ë¡¤ -->
            <div class="volume">
                <label for="volumeControl">ğŸ”Š</label>
                <input type="range" id="volumeControl" min="0" max="1" step="0.1" value="0.5">
            </div>
        </div>
    </div>
    <!-- ê°•ì˜ í›„ê¸° ì„¹ì…˜ -->
    <div class="lecture-feedback">
        <h3>ê°•ì˜ í›„ê¸°</h3>
        <!-- í›„ê¸° ë¦¬ìŠ¤íŠ¸ -->
        <div class="feedback-list">
            <div th:each="feedback : ${lecture.feedbacks}">
                <div class="feedback-item">
                    <p><strong th:text="${feedback.member.name}">User Name</strong> ë‹˜ì˜ í›„ê¸°:</p>
                    <p th:text="${feedback.content}">ê°•ì˜ í›„ê¸° ë‚´ìš©</p>
                </div>
            </div>
        </div>

        <div th:if="${session.user != null}">

            <!-- ë¡œê·¸ì¸í•œ ê²½ìš° ê°•ì˜ í›„ê¸° ì‘ì„± í¼ -->
            <form class="feedback-form" th:action="@{/submit-feedback}" method="post" th:object="${feedback}">
                <textarea name="feedback" placeholder="ê°•ì˜ í›„ê¸°ë¥¼ ì‘ì„±í•´ì£¼ì„¸ìš”..."></textarea>
                <button type="submit">í›„ê¸° ì œì¶œ</button>
            </form>
        </div>
        <div th:unless="${session.user != null}">
            <!-- ë¡œê·¸ì¸í•˜ì§€ ì•Šì€ ê²½ìš° ë¡œê·¸ì¸ í˜ì´ì§€ë¡œ ì´ë™ ì•ˆë‚´ -->
            <p class="login-prompt">í›„ê¸°ë¥¼ ë‚¨ê¸°ë ¤ë©´ <a href="/login">ë¡œê·¸ì¸</a> í•´ì£¼ì„¸ìš”.</p>
        </div>
    </div>
</div>
<th:block th:replace="~{user/layout/footer::footer}" th:remove="tag"></th:block>
<script>
    // ìš”ì†Œ ì„ íƒ
    const video = document.getElementById('videoPlayer');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const rewindBtn = document.getElementById('rewindBtn');
    const forwardBtn = document.getElementById('forwardBtn');
    const progressBar = document.getElementById('progressBar');
    const volumeControl = document.getElementById('volumeControl');

    // ì¬ìƒ/ì¼ì‹œì •ì§€ í† ê¸€
    const togglePlayPause = () => {
        if (video.paused || video.ended) {
            video.play();
            playPauseBtn.innerHTML = 'â¸'; // ì¼ì‹œì •ì§€ ì•„ì´ì½˜
        } else {
            video.pause();
            playPauseBtn.innerHTML = 'â–¶'; // ì¬ìƒ ì•„ì´ì½˜
        }
    };

    // í´ë¦­ ì‹œ ë¹„ë””ì˜¤ ì¬ìƒ/ì¼ì‹œì •ì§€
    video.addEventListener('click', togglePlayPause);

    // ë²„íŠ¼ í´ë¦­ ì‹œ ì¬ìƒ/ì¼ì‹œì •ì§€
    playPauseBtn.addEventListener('click', togglePlayPause);

    // 5ì´ˆ ë’¤ë¡œ ì´ë™
    rewindBtn.addEventListener('click', () => {
        video.currentTime = Math.max(0, video.currentTime - 5);
    });

    // 5ì´ˆ ì•ìœ¼ë¡œ ì´ë™
    forwardBtn.addEventListener('click', () => {
        video.currentTime = Math.min(video.duration, video.currentTime + 5);
    });

    // íƒ€ì„ë¼ì¸ ì—…ë°ì´íŠ¸
    video.addEventListener('timeupdate', () => {
        const progressPercent = (video.currentTime / video.duration) * 100;
        progressBar.style.width = `${progressPercent}%`;
    });

    // íƒ€ì„ë¼ì¸ í´ë¦­ìœ¼ë¡œ ì´ë™
    document.querySelector('.progress').addEventListener('click', (e) => {
        const rect = e.target.getBoundingClientRect();
        const clickPosition = e.clientX - rect.left;
        const clickPercent = clickPosition / rect.width;
        video.currentTime = video.duration * clickPercent;
    });

    // ë³¼ë¥¨ ì»¨íŠ¸ë¡¤
    volumeControl.addEventListener('input', (e) => {
        video.volume = e.target.value;
    });
</script>


</body>
</html>