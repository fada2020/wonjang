<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" th:replace="~{user/layout/layout::layout( ~{::title}, ~{::link}, ~{::style}, ~{::body}, ~{::script}, ~{::meta})}">

<title>강의 페이지</title>
<link rel="stylesheet" th:href="@{/assets/css/user/player.css}">
<body>
<div class="container">
    <div class="custom-video-player">
        <video id="videoPlayer">
            <source th:src="@{${lecture.videoUrl}}" type="video/mp4">
            <p>현재 브라우저는 비디오 태그를 지원하지 않습니다.</p>
        </video>
        <div class="controls">
            <!-- 5초 뒤로 -->
            <button class="play-btn" id="rewindBtn">⏪</button>

            <!-- 재생/일시정지 버튼 -->
            <button class="play-btn" id="playPauseBtn">&#9654;</button>

            <!-- 5초 앞으로 -->
            <button class="play-btn" id="forwardBtn"> ⏩</button>

            <!-- 타임라인 -->
            <div class="timeline">
                <div class="progress">
                    <div class="progress-bar" id="progressBar"></div>
                </div>
            </div>

            <!-- 볼륨 컨트롤 -->
            <div class="volume">
                <label for="volumeControl">🔊</label>
                <input type="range" id="volumeControl" min="0" max="1" step="0.1" value="0.5">
            </div>
        </div>
    </div>
    <!-- 강의 후기 섹션 -->
    <div class="lecture-feedback">
        <h3>강의 후기</h3>
        <!-- 후기 리스트 -->
        <div class="feedback-list">
            <div th:each="feedback : ${lecture.feedbacks}">
                <div class="feedback-item">
                    <p><strong th:text="${feedback.member.name}">User Name</strong> 님의 후기:</p>
                    <p th:text="${feedback.content}">강의 후기 내용</p>
                </div>
            </div>
        </div>

        <div sec:authorize="isAuthenticated()">

            <!-- 로그인한 경우 강의 후기 작성 폼 -->
            <form class="feedback-form" th:action="@{/submit-feedback}" method="post" th:object="${feedback}">
                <textarea name="feedback" placeholder="강의 후기를 작성해주세요..."></textarea>
                <button type="submit">후기 제출</button>
            </form>
        </div>
        <div sec:authorize="isAnonymous()">
            <!-- 로그인하지 않은 경우 로그인 페이지로 이동 안내 -->
            <p class="login-prompt">후기를 남기려면 <a href="/login">로그인</a> 해주세요.</p>
        </div>
    </div>
</div>

</body>
<script>
    // 요소 선택
    const video = document.getElementById('videoPlayer');
    const playPauseBtn = document.getElementById('playPauseBtn');
    const rewindBtn = document.getElementById('rewindBtn');
    const forwardBtn = document.getElementById('forwardBtn');
    const progressBar = document.getElementById('progressBar');
    const volumeControl = document.getElementById('volumeControl');

    // 재생/일시정지 토글
    const togglePlayPause = () => {
        if (video.paused || video.ended) {
            video.play();
            playPauseBtn.innerHTML = '⏸'; // 일시정지 아이콘
        } else {
            video.pause();
            playPauseBtn.innerHTML = '▶'; // 재생 아이콘
        }
    };

    // 클릭 시 비디오 재생/일시정지
    video.addEventListener('click', togglePlayPause);

    // 버튼 클릭 시 재생/일시정지
    playPauseBtn.addEventListener('click', togglePlayPause);

    // 5초 뒤로 이동
    rewindBtn.addEventListener('click', () => {
        video.currentTime = Math.max(0, video.currentTime - 5);
    });

    // 5초 앞으로 이동
    forwardBtn.addEventListener('click', () => {
        video.currentTime = Math.min(video.duration, video.currentTime + 5);
    });

    // 타임라인 업데이트
    video.addEventListener('timeupdate', () => {
        const progressPercent = (video.currentTime / video.duration) * 100;
        progressBar.style.width = `${progressPercent}%`;
    });

    // 타임라인 클릭으로 이동
    document.querySelector('.progress').addEventListener('click', (e) => {
        const rect = e.target.getBoundingClientRect();
        const clickPosition = e.clientX - rect.left;
        const clickPercent = clickPosition / rect.width;
        video.currentTime = video.duration * clickPercent;
    });

    // 볼륨 컨트롤
    volumeControl.addEventListener('input', (e) => {
        video.volume = e.target.value;
    });
</script>


</html>